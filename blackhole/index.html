<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="bootstrap-3.3.5-dist/css/bootstrap.min.css">

	<!-- Optional theme -->
	<!--<link rel="stylesheet" href="bootstrap-3.3.5-dist/css/bootstrap-theme.min.css">-->

	<link rel="stylesheet" href="css/blackhole.css">

	<title>Black Hole</title>
</head>
<body>
	<div class="container">
		<div class="row">
			<div class="col-lg-12">
				<button type="buton" class="btn" id="peek-btn" onclick="peekToggle()">Peek</button>
			</div>
		</div>
		<div class="row">
			<div class="col-lg-12">
				<p id="instructions">Add your thoughts to the black hole.</p>
			</div>
		</div>
		<div class="row">
			<div class="col-lg-12">
				<input type="textfield" id="text_editor" onkeypress="getChar(event)" onkeyup="savedata(event)"></input>
			</div>
		</div>
		<div class="row" id="floating_words">
			<div class="col-lg-12">
				<p id="saved_text"></p>
			</div>
		</div>
		
	</div>
	
		<!-- Latest compiled and minified JavaScript -->
		<!--<script src="jquery-2.1.4.min.js"></script>-->
	<!--<script src="bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>-->

<script>
var peek = false;
var spaces = 0;
var entry = "";

var peekToggle = function () {
	var p = document.getElementById('peek-btn');

	if (!peek) { 
		peek = true; 
		p.className = 'btn active-btn';
		document.getElementById('saved_text').innerHTML = entry;

	}
		else { 
			peek = false; 
			p.className = 'btn';
			document.getElementById('saved_text').innerHTML = "";
	}
}

function getChar(event) {
	var c = null; 
  if (event.which == null) {
    c = String.fromCharCode(event.keyCode) // IE
  } else if (event.which!=0 && event.charCode!=0) {
    c =  String.fromCharCode(event.which)   // the rest
  } 

  console.log(c);
	entry += c; 
}


window.onload = function () {
	document.getElementById('text_editor').focus();

	var d = new Date();
	writeToFile("\'}, \'" + d + "\' : { entry: \'");
}

var savedata = function (event) {

	txt = document.getElementById('text_editor');

	if (peek) {
			document.getElementById('saved_text').innerHTML = entry;
	}

	if (event.keyCode === 32  ||   // space
		  //event.keyCode === 190 ||   // period
		  //event.keyCode === 191 ||   // question
		  //event.keyCode === 49  ||   // exclamation
		  event.keyCode === 13) {    // newline

		/*	if (event.keyCode === 32) {
				spaces++;
				if (spaces % 2 === 1) {
					return 0;
				}
			}*/
		  
			writeToFile(txt.value);
			txt.value = "";

		}

	}

var writeToFile = function(entry) {
	var xmlhttp;

	// code for IE7+, Firefox, Chrome, Opera, Safari
	if (window.XMLHttpRequest) {
	 xmlhttp = new XMLHttpRequest(); 
	}
	else { // code for IE6, IE5
	  xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
	}

	xmlhttp.open("POST","savedata.php",true);
	xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
	xmlhttp.send("entry=" + entry);
}

</script>
</body>
</html>